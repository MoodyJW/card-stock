@if (registered()) {
  <div class="confirmation">
    <mat-icon class="confirmation-icon">mark_email_read</mat-icon>
    <h2>Check your email</h2>
    <p>
      We've sent a confirmation link to <strong>{{ form.controls.email.value }}</strong>
    </p>
    <p class="confirmation-hint">Click the link in the email to activate your account.</p>
    <a routerLink="/auth/login" mat-stroked-button class="back-btn">Back to login</a>
  </div>
} @else {
  <h2 class="auth-title">Create your account</h2>

  @if (error()) {
    <p class="auth-error">{{ error() }}</p>
  }

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <mat-form-field appearance="outline">
      <mat-label>Email</mat-label>
      <input matInput type="email" formControlName="email" autocomplete="email" />
      @if (form.controls.email.hasError('required')) {
        <mat-error>Email is required</mat-error>
      } @else if (form.controls.email.hasError('email')) {
        <mat-error>Enter a valid email</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Password</mat-label>
      <input
        matInput
        [type]="hidePassword() ? 'password' : 'text'"
        formControlName="password"
        autocomplete="new-password"
      />
      <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()">
        <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (form.controls.password.hasError('required')) {
        <mat-error>Password is required</mat-error>
      } @else if (form.controls.password.hasError('minlength')) {
        <mat-error>Must be at least 8 characters</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Confirm password</mat-label>
      <input
        matInput
        [type]="hideConfirm() ? 'password' : 'text'"
        formControlName="confirmPassword"
        autocomplete="new-password"
      />
      <button mat-icon-button matSuffix type="button" (click)="toggleConfirmVisibility()">
        <mat-icon>{{ hideConfirm() ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      @if (form.controls.confirmPassword.hasError('required')) {
        <mat-error>Confirm your password</mat-error>
      } @else if (form.hasError('passwordsMismatch')) {
        <mat-error>Passwords do not match</mat-error>
      }
    </mat-form-field>

    <button mat-flat-button color="primary" type="submit" [disabled]="loading()" class="submit-btn">
      @if (loading()) {
        <mat-spinner diameter="20" />
      } @else {
        Create account
      }
    </button>
  </form>

  <div class="auth-links">
    <a routerLink="/auth/login">Already have an account? <strong>Log in</strong></a>
  </div>
}
